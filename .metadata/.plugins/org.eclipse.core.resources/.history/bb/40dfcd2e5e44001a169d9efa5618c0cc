package cinema.DAO;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import cinema.Model.User;

public class UserDAO {
	
	
	public static User get(String korisnickoIme,String lozinka) {
		
		Connection conn = ConnectionManager.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rset=null;
		try {
			String query = "SELECT Id,RegistrationDate,Role WHERE Username=? AND Password=? AND Deleted=?;";
			
			pstmt=conn.prepareStatement(query);
			int index = 1;
			
			pstmt.setString(index ++, korisnickoIme);
			pstmt.setString(index ++, lozinka);
			Boolean obrisan = false;
			pstmt.setBoolean(index ++, obrisan);
			System.out.println(pstmt);
			rset=pstmt.executeQuery();
			if(rset.next()) {
				
				Korisnik.Uloga uloga = Korisnik.Uloga.valueOf(rset.getString(1).toUpperCase());
				System.out.println(uloga);
				Timestamp datumRegistracije=rset.getTimestamp(2);
				System.out.println(datumRegistracije);
				Boolean blokiran = rset.getBoolean(3);
				return new Korisnik(korisnickoIme,lozinka,datumRegistracije,uloga,blokiran);
			}
			
		} catch (Exception e) {
			e.printStackTrace();
		}finally{
			try {pstmt.close();} catch (Exception ex1) {ex1.printStackTrace();}
			try {rset.close();} catch (Exception ex1) {ex1.printStackTrace();}
			try {conn.close();} catch (Exception ex1) {ex1.printStackTrace();} 
			
		}
				
		return null;

}
